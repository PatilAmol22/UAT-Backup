<template>
    <div class="slds-box slds-theme_default" style="margin-bottom:10px;">
        <div class="slds-page-header" style="padding:0 0 0 10px;">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-action-account" title={label.Products_Details}>
                                <lightning-icon icon-name="standard:product_item" title={label.Products_Details} size="medium"> </lightning-icon> 
                                <span class="slds-assistive-text">{label.Products_Details}</span>
                            </span>
                        </div>
            
                        <div class="slds-media__body">
                            <div class="slds-page-header__name">
                                <div class="slds-page-header__name-title">
                                    <h1>
                                        <span class="slds-page-header__title slds-truncate" title={label.Products_Details} style="margin-top:12px;">{label.Products_Details}</span>
                                    </h1>
                                </div>
                            </div>
                        </div>
                        <lightning-button variant="brand" icon-name="utility:add" title={label.ADD} disabled={isDisable} class="slds-m-right_x-small slds-float_right" style="margin-top:8px;" onclick={openModal}></lightning-button>
            
                    </div>
                </div>
            </div>
        </div>

            <!--<div style="background: rgb(0 156 219); color:#fff; font-size:15px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                <h4>PRODUCTS DETAILS</h4>
            </div>-->

        <div class="slds-scrollable_x">
            <table class="slds-table slds-table_bordered" aria-labelledby="element-with-table-label other-element-with-table-label" style="border:1px solid rgb(229, 229, 229);">
                <thead>
                    <tr class="slds-hint-parent">
                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>{label.Invoice}</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>{label.Product_Code}</strong></div>
                        </th>

                        <th data-label="" scope="row" style="width: 300px;">
                            <div class="slds-truncate" title=""><strong>{label.Product_Name}</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>{label.Volume_KG_LT}</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>{label.Unit_Value}</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>{label.Total_Value}</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>{label.Expire_Date}</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title=""><strong>{label.Batch}</strong></div>
                        </th>

                        <th data-label="" scope="row">
                            <div class="slds-truncate" title="" style="text-align: center;"><strong>{label.Action}</strong></div>
                        </th>
                    </tr>
                </thead>
                <tbody>  
                    <template if:true={isProductList}>
                        <template for:each={productList} for:item="prod" for:index="i">      
                            <tr class="slds-hint-parent" key={prod.srNo}>
                            
                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.invoiceName} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.productCode} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.productName} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="number" min="0" step="0.01" value={prod.volume} disabled="true"></lightning-input>
                                    </div>
                                </td>    

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="number" min="0" step="0.01" value={prod.unitValue} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="number" min="0" step="0.01" value={prod.totalValue} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="date"  value={prod.expireDate} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div class="slds-truncate" title="" style="margin-top: -15px;">
                                        <lightning-input type="text"  value={prod.batch} disabled="true"></lightning-input>
                                    </div>
                                </td>

                                <td data-label="">
                                    <div>
                                        <lightning-button variant="brand" name={i} value={prod.recId} onclick={editProduct} title={label.Edit} icon-name="utility:edit" class="slds-m-right_x-small"></lightning-button>&nbsp;
                                        <lightning-button variant="destructive" name={i} value={prod.recId} onclick={removeProduct} disabled={isDisable} title={label.Delete} icon-name="utility:delete" class="slds-m-right_x-small"></lightning-button>  
                                    </div>
                                </td>

                            </tr>
                        </template>
                    </template>
                    <template if:false={isProductList}>
                        <tr class="slds-hint-parent">
                            <td colspan="9"><div class="slds-truncate" title="" style="text-align:center;"><b>{label.NoRecordsFound}</b></div></td>                         
                        </tr> 
                    </template>
                </tbody>
            </table>
        </div>


        <!--<div class="slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12" style="margin:15px 0px 15px 0;  padding:10px; border-top: 1px solid rgb(229, 229, 229);">
        <lightning-button variant="Brand" label="Save" title="Save" class="slds-m-right_x-small slds-float_right"></lightning-button>
        <lightning-button variant="Brand" label="Cancel" title="Cancel" class="slds-m-right_x-small slds-float_right"></lightning-button>
        </div>-->

    </div>

    <!-- modal start -->  
    <template if:true={bShowModal}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-modal_large slds-fade-in-open" style="margin:0 auto; width:80%;">
            <template if:true={showSpinner}>
                <div class="exampleHolder">
                    <lightning-spinner alternative-text={label.PleaseWait} size="medium" variant="brand"></lightning-spinner>
                </div>
            </template>
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title={label.Close} onclick={closeModal}>
                        <lightning-icon icon-name="utility:close"
                        alternative-text={label.Close}
                        variant="inverse"
                        size="small" ></lightning-icon>
                        <span class="slds-assistive-text">{label.Close}</span>
                    </button>
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">{label.Product_Selection_Form}</h2>
                </header>
                
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    
                    <div class="slds-grid slds-gutters slds-wrap">
                        <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                            <h4>{label.Invoice}</h4>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex" style="padding-top:10px;">
                            <span>{label.Invoice}</span>
                            <c-lookupcmp placeholder={label.Search_Invoice}  iconname='standard:budget_category_value' multiselect=false sobject='Invoice__c'
                                fieldname='OwnerId, Name, Sales_Org__c, Sold_To_Party__c, Nota_Fiscal__c ' 
                                filter={invcFilter} displayfield={invcSerarchField} onselected={handleInvoiceSelected} disable={invcDisable}
                                singleselectedrec={invcName} onremove={handleRemoveInvoice} cmpwidth='long'></c-lookupcmp>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex" style="padding-top:10px;">
                            
                            <!-- <c-lookupcmp placeholder={label.Search_Product}  iconname='standard:product_item' multiselect=false sobject='Invoice_Line_Item__c '
                                fieldname=' Name, CurrencyIsoCode, Invoice__c, SKU__c, SKU_Code__c, SKU__r.Name, SKU_Description__c ' 
                                filter={invcItemFilter} displayfield={invcItemSerarchField} onselected={handleInvoiceItemSelected} 
                                singleselectedrec={invcItemName} onremove={handleRemoveInvoiceItem} cmpwidth='long'></c-lookupcmp> -->
                            <template if:true={showProduct}>    
                                <span>{label.Product_Code}</span>
                                <c-dynamiclookupcmp 
                                    placeholder={label.Search_Product} 
                                    iconname='standard:product_item' 
                                    onremove={handleRemoveInvoiceItem} 
                                    onselected={handleInvoiceItemSelected}  
                                    singleselectedrec={invcItemName} 
                                    sobject='Invoice_Line_Item__c'
                                    keyfield = 'Id' 
                                    displayfields={invcItemSerarchField}
                                    mergefields='Batch__c,Billing_DOC_reference_number__c'
                                    filter={invcItemFilter}
                                    cmpwidth='width:210px;'
                                    spinnerwidth='margin-left: 11rem;'>
                                </c-dynamiclookupcmp>    
                            </template>
                            <template if:false={showProduct}>
                                <lightning-input type="text" name="prodCode" label={label.Product_Code} disabled="true"></lightning-input>
                            </template>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="prodDetals" label={label.Products_Details} value={productObj.productDescription} onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="batch" label={label.Batch} value={productObj.batch} onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                            <h4>{label.Commercial}</h4>
                        </div>


                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="currencyCode" class="validt" label={label.Currency} value={productObj.currencyCode} required="true" onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="number" min="0" step="0.01" name="volume" class="validt" label={label.Volume} value={productObj.volume} required="true" onblur={handleVolumeChange} disabled={isDisable}></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="uom" class="validt" label={label.UOM} value={productObj.uom} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="number" min="0" step="0.01" name="unitVal" class="validt" label={label.Unit_Value} value={productObj.unitValue} onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="number" min="0" step="0.01" name="totalVal" class="validt" label={label.Total_Value} value={productObj.totalValue} required="true" onblur={handleChange} disabled="true"></lightning-input>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="date" name="expDate" class="validt" label={label.Expire_Date} value={productObj.expireDate} required="true" onchange={handleChange} disabled="true"></lightning-input>
                        </div>


                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label={label.At_AG} name="atAg" class="validt" options={atAgOptions} value={productObj.atAG} onchange={handleChange} required="true" disabled={isDisable}> 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label={label.Product_Damaged} name="prodDamage" class="validt" value={productObj.productDamage} options={prodDamageOptions} onchange={handleChange} required="true" disabled={isDisable}> 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label={label.Packaging_Conditions} name="packCondtn" class="validt" value={productObj.packagingCondition} options={packgCondtnOptions} onchange={handleChange} required="true" disabled={isDisable}> 
                            </lightning-combobox>
                        </div>

                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                            <lightning-combobox 
                                label={label.Product_Conditions} name="prodCondtn" class="validt" value={productObj.productCondition} options={prodCondtnOptions} onchange={handleChange} required="true" disabled={isDisable}> 
                            </lightning-combobox>
                        </div>

                        <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                            <h4>{label.Comments}</h4>
                        </div>


                        <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_12-of-12 slds-form-element__label slds-no-flex">
                            <lightning-input type="text" name="comments" label={label.Comments} value={productObj.comments} onblur={handleChange} disabled={isDisable}></lightning-input>
                        </div>

                        <template if:false={qualityEdit}>
                            <div style="background: rgb(0 156 219); color:#fff; font-size:12px; font-weight:600; padding:10px; margin:10px 0; width:100%;">
                                <h4>{label.Quality}</h4>
                            </div>


                            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                                <lightning-combobox 
                                    label={label.Slow_Moving} name="sloMo" value={productObj.slowMoving} options={slowMovOptions} onchange={handleChange} > 
                                </lightning-combobox>
                            </div>

                            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                                <lightning-combobox 
                                    label={label.Product_Contention} name="prodConten" value={productObj.productContention} options={prodContentnOptions} onchange={handleChange} > 
                                </lightning-combobox>
                            </div>

                            <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                                <lightning-combobox 
                                    label={label.Product_Can_Be_Reworked} name="prodRewrk" value={productObj.productRework} options={prodReworkOptions} onchange={handleChange} > 
                                </lightning-combobox>
                            </div>

                            <template if:true={reworkYes}>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                                    <lightning-input type="number" min="0" step="0.01" name="reworkCost" label={label.Rework_Cost} value={productObj.reworkCost} onblur={handleChange} ></lightning-input>
                                </div>
                            </template>

                            <template if:true={reworkNo}>
                                <div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12 slds-large-size_3-of-12 slds-form-element__label slds-no-flex">
                                    <lightning-input type="text" name="writeOff" label={label.Write_Off} value={productObj.writeOff} onblur={handleChange} ></lightning-input>
                                </div>
                            </template>
                        </template>
                    </div>
                </div>
            
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_brand" disabled={disableSave} onclick={saveProduct}>{label.Save}</button>
                    <button class="slds-button slds-button_destructive" onclick={closeModal}>{label.Cancel}</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>